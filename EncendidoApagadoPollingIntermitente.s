        .include  "inter.inc"
.text
	mrs r0, cpsr
	mov r0, #0b11010011 @Modo SVC, FIQ&IRQ desact
	msr spsr_cxsf, r0
	add r0, pc, #4
	msr ELR_hyp, r0
	eret
	
	mov 	r0, #0b11010011
	msr	cpsr_c, r0
	mov 	sp, #0x8000000
	
	
        ldr     r0, =GPBASE
/* guia bits          xx999888777666555444333222111000*/
        ldr   	r1, =0b00000000001000000000000000001001
        str	r1, [r0, #GPFSEL1] 
	
/* guia bits  xx999888777666555444333222111000*/
        ldr   	r1, =0b00000000001000000000000001000000
        str	r1, [r0, #GPFSEL2]

/* guia bits          xx999888777666555444333222111000*/
        ldr   	r1, =0b00001000001000000000000000000000
        str	r1, [r0, #GPFSEL0]


/* guia bits                  10987654321098765432109876543210*/
        mov   	r1, #0b00000000000000100000110000000000
        str     r1, [r0, #GPSET0]
	
/* guia bits                10987654321098765432109876543210*/
        mov   	r1, #0b0001000010000000000000000000000
        str     r1, [r0, #GPSET0] 
	
/* guia bits                10987654321098765432109876543210*/
        mov   	r1, #0b0000000000000000000001000000000
        str     r1, [r0, #GPSET0]
	
	ldr   r4, =STBASE 
	ldr   r5 ,=500000
	
bucle:	
	ldr	r1, [r0, #GPLEV0]
	ands	r2, r1, #0b00000000000000000000000000000100
	beq	pulsador1
	ands	r2, r1, #0b00000000000000000000000000001000
	beq	pulsador2
	b 	bucle
	
pulsador1:	
	/* guia bits          10987654321098765432109876543210*/
        ldr   	r1, =0b00000000000000000000010000000000
        str     r1, [r0, #GPCLR0]
	
	/* guia bits          10987654321098765432109876543210*/
        ldr   	r1, =0b00001000000000000000000000000000
        str     r1, [r0, #GPCLR0]
	
	/* guia bits          10987654321098765432109876543210*/
        ldr   	r1, =0b00000000000000100000000000000000
        str     r1, [r0, #GPCLR0]
	
	
		/* guia bits        10987654321098765432109876543210*/
        ldr   	r1, =0b0000000000000000000001000000000
        str     r1, [r0, #GPSET0]
	
	/* guia bits          10987654321098765432109876543210*/
        ldr   	r1, =0b00000000000000000000100000000000
        str     r1, [r0, #GPSET0]
	
	/* guia bits        10987654321098765432109876543210*/
        ldr   	r1, =0b0000000010000000000000000000000
        str     r1, [r0, #GPSET0]
	
	bl espera
	
	/* guia bits        10987654321098765432109876543210*/
        ldr   	r1, =0b0000000000000000000001000000000
        str     r1, [r0, #GPCLR0]
	
	/* guia bits          10987654321098765432109876543210*/
        ldr   	r1, =0b00000000000000000000100000000000
        str     r1, [r0, #GPCLR0]
	
	/* guia bits        10987654321098765432109876543210*/
        ldr   	r1, =0b0000000010000000000000000000000
        str     r1, [r0, #GPCLR0]
	
	bl espera
	
	ldr	r1, [r0, #GPLEV0]
	ands	r2, r1, #0b00000000000000000000000000000100
	beq	pulsador1
	ands	r2, r1, #0b00000000000000000000000000001000
	beq	pulsador2
	b 	pulsador1
	
pulsador2:	
	/* guia bits        10987654321098765432109876543210*/
        mov   	r1, #0b0000000000000000000001000000000
        str     r1, [r0, #GPCLR0]
	
	/* guia bits          10987654321098765432109876543210*/
        mov   	r1, #0b00000000000000000000100000000000
        str     r1, [r0, #GPCLR0]
	
	/* guia bits        10987654321098765432109876543210*/
        mov   	r1, #0b0000000010000000000000000000000
        str     r1, [r0, #GPCLR0]

	
	/* guia bits          10987654321098765432109876543210*/
        mov   	r1, #0b00000000000000000000010000000000
        str     r1, [r0, #GPCLR0]
	
	/* guia bits          10987654321098765432109876543210*/
        mov   	r1, #0b00001000000000000000000000000000
        str     r1, [r0, #GPCLR0]
	
	/* guia bits          10987654321098765432109876543210*/
        mov   	r1, #0b00000000000000100000000000000000
        str     r1, [r0, #GPCLR0]
	
	bl espera
	
	/* guia bits          10987654321098765432109876543210*/
        mov   	r1, #0b00000000000000100000000000000000
        str     r1, [r0, #GPSET0] 
	
	/* guia bits          10987654321098765432109876543210*/
        mov   	r1, #0b00001000000000000000000000000000
        str     r1, [r0, #GPSET0] 
	
	/* guia bits        10987654321098765432109876543210*/
        mov   	r1, #0b00000000000000000000010000000000
        str     r1, [r0, #GPSET0] 
	
	bl espera
	
	ldr	r1, [r0, #GPLEV0]
	ands	r2, r1, #0b00000000000000000000000000000100
	beq	pulsador1
	ands	r2, r1, #0b00000000000000000000000000001000
	beq	pulsador2
	b 	pulsador2

espera: 
	push {r0,r1}
	ldr r0,[r4,#STCLO]
	add r0,r5
ret1:ldr r1,[r4,#STCLO]
	cmp r1,r0
	blo ret1
	pop { r0,r1}
	bx lr